name: Extract APK Signature

on:
  workflow_dispatch:   # lo lanzas manualmente desde la pestaña Actions

jobs:
  verify:
    runs-on: ubuntu-latest
    steps:
      - name: Descargar APK desde release
        run: |
          curl -L https://github.com/Jesusdio2/PrivateSignature/releases/download/Dev0/Servicios.de.Google.Play.7.apk -o app.apk

      - name: Instalar Android SDK y Build Tools
        run: |
          sudo apt-get update
          sudo apt-get install -y wget unzip openjdk-17-jre-headless
          wget https://dl.google.com/android/repository/commandlinetools-linux-11076708_latest.zip -O cmdline-tools.zip
          mkdir -p $HOME/android-sdk/cmdline-tools/latest
          unzip cmdline-tools.zip -d $HOME/android-sdk/cmdline-tools/latest
          # mover el contenido interno a la raíz de latest
          mv $HOME/android-sdk/cmdline-tools/latest/cmdline-tools/* $HOME/android-sdk/cmdline-tools/latest/
          export ANDROID_HOME=$HOME/android-sdk
          export PATH=$ANDROID_HOME/cmdline-tools/latest/bin:$PATH
          yes | sdkmanager --sdk_root=$ANDROID_HOME "platform-tools" "build-tools;34.0.0"

      - name: Extraer huella SHA-256 con apksigner
        run: |
          $HOME/android-sdk/build-tools/34.0.0/apksigner verify --print-certs --verbose app.apk \
            | grep 'SHA-256 digest:' \
            | sed 's/.*SHA-256 digest: //' \
            > fingerprint.txt

      - name: Mostrar huella en logs
        run: cat fingerprint.txt

      - name: Subir artifact con la huella
        uses: actions/upload-artifact@v4
        with:
          name: APK-Certificate-Fingerprint
          path: fingerprint.txt
